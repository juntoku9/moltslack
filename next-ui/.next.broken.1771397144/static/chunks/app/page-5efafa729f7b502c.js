(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{8717:(e,t,n)=>{Promise.resolve().then(n.bind(n,1793))},1793:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>h});var i,r=n(5155),a=n(2115);let d=e=>{let t;let n=new Set,i=(e,i)=>{let r="function"==typeof e?e(t):e;if(!Object.is(r,t)){let e=t;t=(null!=i?i:"object"!=typeof r||null===r)?r:Object.assign({},t,r),n.forEach(n=>n(t,e))}},r=()=>t,a={setState:i,getState:r,getInitialState:()=>d,subscribe:e=>(n.add(e),()=>n.delete(e))},d=t=e(i,r,a);return a},l=e=>e?d(e):d,o=e=>e,s=e=>{let t=l(e),n=e=>(function(e,t=o){let n=a.useSyncExternalStore(e.subscribe,()=>t(e.getState()),()=>t(e.getInitialState()));return a.useDebugValue(n),n})(t,e);return Object.assign(n,t),n},c=(e=>e?s(e):s)((e,t)=>({chats:[],selectedChatId:null,viewMode:"terminal",executionMode:"interactive",defaultProvider:"claude",messages:{},activity:{},terminalOutput:{},setChats:t=>e({chats:t}),addChat:t=>e(e=>({chats:[...e.chats,t]})),selectChat:t=>e({selectedChatId:t}),setViewMode:t=>e({viewMode:t}),toggleExecutionMode:()=>e(e=>({executionMode:"interactive"===e.executionMode?"structured":"interactive"})),setDefaultProvider:t=>e({defaultProvider:t}),appendMessage:(t,n)=>e(e=>{var i;return{messages:{...e.messages,[t]:[...null!==(i=e.messages[t])&&void 0!==i?i:[],n].slice(-400)}}}),appendActivity:(t,n)=>e(e=>{var i;return{activity:{...e.activity,[t]:[...null!==(i=e.activity[t])&&void 0!==i?i:[],n].slice(-1e3)}}}),appendTerminal:(t,n)=>e(e=>{var i;return{terminalOutput:{...e.terminalOutput,[t]:(null!==(i=e.terminalOutput[t])&&void 0!==i?i:"")+n}}}),clearTerminal:t=>e(e=>({terminalOutput:{...e.terminalOutput,[t]:""}}))})),u=null!==(i=n(2818).env.NEXT_PUBLIC_WS_URL)&&void 0!==i?i:"ws://127.0.0.1:8081/ws",p="moltslack$ ",f=/[\u001B\u009B][[\]()#;?]*(?:\d{1,4}(?:;\d{0,4})*)?[0-9A-ORZcf-nqry=><]/g;function h(){let{chats:e,selectedChatId:t,viewMode:i,messages:d,activity:l,setChats:o,addChat:s,selectChat:h,setViewMode:g,appendMessage:b,appendActivity:x}=c(),[v,y]=(0,a.useState)(""),[m,S]=(0,a.useState)(!1),w=(0,a.useRef)(null),j=(0,a.useRef)(null),k=(0,a.useRef)(null),O=(0,a.useRef)(null),C=(0,a.useRef)({}),R=(0,a.useMemo)(()=>{var e;return t&&null!==(e=d[t])&&void 0!==e?e:[]},[t,d]),E=(0,a.useMemo)(()=>{var e;return t&&null!==(e=l[t])&&void 0!==e?e:[]},[t,l]);async function N(){let e="chat-".concat(Date.now().toString().slice(-4)),t=await fetch("/api/chats",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({title:e})}),n=await t.json();s(n.chat),h(n.chat.id)}async function D(){let e=v.trim();t&&e&&(y(""),b(t,{role:"user",text:e,provider:"terminal",ts:Date.now()}),x(t,{provider:"terminal",stage:"input",detail:"sent: ".concat(e.slice(0,120)),ts:Date.now()}),C.current[t]={cmd:e,buffer:""},await fetch("/api/chats/".concat(t,"/input"),{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({text:"".concat(e,"\r")})}))}return(0,a.useEffect)(()=>{let e=null,i=!1,r=null;(async()=>{let[{Terminal:a},{FitAddon:d}]=await Promise.all([n.e(806).then(n.t.bind(n,6841,23)),n.e(29).then(n.t.bind(n,2029,23))]);if(i)return;e=new a({cursorBlink:!0,convertEol:!1,fontFamily:"Menlo, Monaco, 'Courier New', monospace",fontSize:14,theme:{background:"#050d24",foreground:"#d1fae5"}});let l=new d;e.loadAddon(l),w.current&&(e.open(w.current),l.fit()),j.current=e,k.current=l,r=e.onData(e=>{t&&fetch("/api/chats/".concat(t,"/input"),{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({text:e})}).catch(()=>{})})})();let a=()=>{t&&k.current&&j.current&&(k.current.fit(),fetch("/api/chats/".concat(t,"/resize"),{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({cols:j.current.cols,rows:j.current.rows})}).catch(()=>{}))};return window.addEventListener("resize",a),()=>{i=!0,window.removeEventListener("resize",a),null==r||r.dispose(),null==e||e.dispose()}},[t]),(0,a.useEffect)(()=>{fetch("/api/chats").then(e=>e.json()).then(e=>{if(o(e.chats||[]),!t){var n;(null===(n=e.chats)||void 0===n?void 0:n.length)?h(e.chats[0].id):N()}}).catch(()=>{})},[]),(0,a.useEffect)(()=>{let e=new WebSocket(u);return O.current=e,e.onopen=()=>{S(!0),t&&e.send(JSON.stringify({type:"subscribe",chatId:t}))},e.onclose=()=>S(!1),e.onerror=()=>S(!1),e.onmessage=e=>{var n,i,r,a,d,l,o,s,c,u,h;let g;try{g=JSON.parse(e.data)}catch(e){return}if("event"===g.type){if("output"===g.event){let e=String(null!==(i=g.payload.text)&&void 0!==i?i:"");if(null===(n=j.current)||void 0===n||n.write(e),t){let n=C.current[t];if(n&&(n.buffer+=e.replace(f,"").replace(/\r/g,"").replace(/\u0000/g,""),n.buffer.includes("\n".concat(p))||n.buffer.endsWith(p))){let e=n.buffer;e.endsWith(p)&&(e=e.slice(0,-p.length));let i=e.lastIndexOf("\n".concat(p));i>=0&&(e=e.slice(0,i));let r=(e=e.replace(new RegExp("^.*?".concat(p.replace(/\$/g,"\\$"))),"")).split("\n").map(e=>e.trimEnd());for(;r.length&&!r[0].trim();)r.shift();r.length&&r[0].trim()===n.cmd.trim()&&r.shift();let a=r.join("\n").trim();a&&b(t,{role:"assistant",text:a,provider:"terminal",ts:Date.now()}),delete C.current[t]}}return}if("chat"===g.event&&t){b(t,{role:null!==(r=g.payload.role)&&void 0!==r?r:"assistant",text:String(null!==(a=g.payload.text)&&void 0!==a?a:""),provider:String(null!==(d=g.payload.provider)&&void 0!==d?d:""),ts:Number(null!==(l=g.payload.ts)&&void 0!==l?l:Date.now())});return}if(("activity"===g.event||"thought"===g.event)&&t){let e="thought"===g.event?"(thinking) ".concat(String(null!==(o=g.payload.text)&&void 0!==o?o:"")):String(null!==(s=g.payload.detail)&&void 0!==s?s:"activity");x(t,{provider:String(null!==(c=g.payload.provider)&&void 0!==c?c:"runtime"),stage:String(null!==(u=g.payload.stage)&&void 0!==u?u:"thought"===g.event?"thought":"stream"),detail:e,ts:Number(null!==(h=g.payload.ts)&&void 0!==h?h:Date.now())})}}},()=>{e.close()}},[x,b,t]),(0,a.useEffect)(()=>{var e,n;t&&O.current&&(O.current.readyState===WebSocket.OPEN&&O.current.send(JSON.stringify({type:"subscribe",chatId:t})),null===(e=j.current)||void 0===e||e.reset(),null===(n=j.current)||void 0===n||n.clear())},[t]),(0,r.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"230px 1fr",height:"100vh"},children:[(0,r.jsxs)("aside",{style:{background:"linear-gradient(180deg,#111827 0%,#0b1220 100%)",color:"#e5e7eb",padding:12},children:[(0,r.jsx)("h1",{style:{margin:"0 0 8px",fontSize:36},children:"MoltSlack"}),(0,r.jsx)("button",{onClick:N,style:{width:"100%",border:"1px solid #374151",background:"#2563eb",color:"#fff",borderRadius:8,padding:"8px 10px"},children:"+ New Chat"}),(0,r.jsx)("div",{style:{marginTop:10,display:"flex",flexDirection:"column",gap:6},children:e.map(e=>(0,r.jsx)("button",{onClick:()=>h(e.id),style:{textAlign:"left",padding:"8px 10px",borderRadius:8,border:e.id===t?"1px solid #2b5d87":"1px solid transparent",background:e.id===t?"#1f3b57":"transparent",color:"#e5e7eb"},children:e.title},e.id))})]}),(0,r.jsxs)("main",{style:{display:"grid",gridTemplateRows:"48px 1fr 68px"},children:[(0,r.jsxs)("div",{style:{background:"#fff",borderBottom:"1px solid #d1d5db",display:"flex",alignItems:"center",justifyContent:"space-between",padding:"0 12px"},children:[(0,r.jsxs)("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[(0,r.jsx)("strong",{children:t||"No chat selected"}),(0,r.jsx)("span",{style:{color:"#6b7280",fontSize:12},children:"One PTY session. Chat is mirrored from terminal output."}),(0,r.jsxs)("span",{style:{fontSize:11,borderRadius:999,padding:"2px 8px",border:"1px solid #d1d5db",color:m?"#065f46":"#991b1b",background:m?"#ecfdf5":"#fef2f2"},children:["WS ",m?"connected":"disconnected"]})]}),(0,r.jsxs)("div",{style:{display:"flex",gap:6},children:[(0,r.jsx)("button",{onClick:()=>g("terminal"),style:{borderRadius:8,border:"1px solid #d1d5db",padding:"6px 10px",background:"terminal"===i?"#0f766e":"#f3f4f6",color:"terminal"===i?"#fff":"#111827"},children:"Terminal"}),(0,r.jsx)("button",{onClick:()=>g("chat"),style:{borderRadius:8,border:"1px solid #d1d5db",padding:"6px 10px",background:"chat"===i?"#0f766e":"#f3f4f6",color:"chat"===i?"#fff":"#111827"},children:"Chat"}),(0,r.jsx)("button",{onClick:()=>g("activity"),style:{borderRadius:8,border:"1px solid #d1d5db",padding:"6px 10px",background:"activity"===i?"#0f766e":"#f3f4f6",color:"activity"===i?"#fff":"#111827"},children:"Activity"})]})]}),(0,r.jsxs)("section",{style:{margin:12,borderRadius:12,border:"1px solid #1f2937",overflow:"hidden",background:"terminal"===i?"radial-gradient(circle at top right,#152040 0%,#0b1020 40%,#080c16 100%)":"#f8fafc"},children:["terminal"===i&&(0,r.jsx)("div",{ref:w,style:{width:"100%",height:"100%"}}),"chat"===i&&(0,r.jsx)("div",{style:{maxWidth:1200,margin:"0 auto",padding:16,display:"flex",flexDirection:"column",gap:10},children:R.map((e,t)=>(0,r.jsx)("div",{style:{alignSelf:"user"===e.role?"flex-end":"assistant"===e.role?"flex-start":"center",maxWidth:"92%",borderRadius:12,padding:"10px 12px",whiteSpace:"pre-wrap",border:"1px solid #d1d5db",background:"user"===e.role?"#dbeafe":"assistant"===e.role?"#fff":"#f3f4f6"},children:e.text},"".concat(t,"-").concat(e.ts)))}),"activity"===i&&(0,r.jsx)("div",{style:{maxWidth:1200,margin:"0 auto",padding:16,display:"flex",flexDirection:"column",gap:8},children:E.map((e,t)=>(0,r.jsxs)("div",{style:{background:"#fff",border:"1px solid #e5e7eb",borderRadius:10,padding:"8px 10px",fontSize:12},children:[(0,r.jsx)("span",{style:{color:"#6b7280",marginRight:6},children:new Date(e.ts).toLocaleTimeString()}),(0,r.jsxs)("span",{style:{display:"inline-block",marginRight:6,border:"1px solid #d1d5db",borderRadius:999,padding:"1px 6px"},children:[e.provider,":",e.stage]}),e.detail]},"".concat(t,"-").concat(e.ts)))})]}),(0,r.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 100px",gap:8,padding:"10px 12px",borderTop:"1px solid #d1d5db",background:"#fff"},children:[(0,r.jsx)("textarea",{value:v,onChange:e=>y(e.target.value),onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),D())},placeholder:"Send to active terminal session. Chat view mirrors terminal output.",style:{border:"1px solid #d1d5db",borderRadius:8,padding:10,fontSize:14,resize:"none"}}),(0,r.jsx)("button",{onClick:()=>void D(),style:{border:"1px solid #0f766e",borderRadius:8,background:"#0f766e",color:"#fff"},children:"Send"})]})]})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[441,517,358],()=>t(8717)),_N_E=e.O()}]);